import{a as o}from"dist/c/c-TRUED2VQ.js";import{a as g,b as _}from"dist/c/c-T7PYU5WU.js";import"dist/c/c-PKXIA66O.js";import"dist/c/c-KBGA43VD.js";import"dist/c/c-OHMLYMRE.js";import"dist/c/c-RTXWLIMX.js";import"dist/c/c-GKMUSAHJ.js";import"dist/c/c-CZWVIXQR.js";import"dist/c/c-NENDH76W.js";import"dist/c/c-MM4QDY4C.js";import"dist/c/c-FK5OVGWM.js";import"dist/c/c-3E2ALMRI.js";import"dist/c/c-GDKDTAPO.js";import"dist/c/c-D4FJECGV.js";import"dist/c/c-J2LR27TH.js";import"dist/c/c-LW7ZHPL2.js";import"dist/c/c-LECXSGS2.js";import"dist/c/c-QG73IUPX.js";import"dist/c/c-TRAMVNXD.js";import"dist/c/c-VCYABVGR.js";import"dist/c/c-ILKXH3EU.js";import"dist/c/c-THLH6QEI.js";import"dist/c/c-4LRVRSUQ.js";import"dist/c/c-KHGSB6GK.js";import"dist/c/c-Q2M4LT2Y.js";import"dist/c/c-JUM4GBMB.js";import"dist/c/c-DUBDCQPG.js";import"dist/c/c-C4ELSJGK.js";import"dist/c/c-WJU64RT4.js";import"dist/c/c-P7TDYH2K.js";import"dist/c/c-GHXNGV7G.js";import"dist/c/c-R2ZIKGWF.js";import"dist/c/c-EK65EX7D.js";import"dist/c/c-WZT27OBV.js";import"dist/c/c-J52F52RJ.js";import"dist/c/c-4DXBADYR.js";import"dist/c/c-AQIECKQR.js";import"dist/c/c-MVSRRX3B.js";import"dist/c/c-KNUKJBB6.js";import"dist/c/c-JBU3E5FJ.js";import"dist/c/c-SMKCRPB7.js";import"dist/c/c-NKKTLFPU.js";import"dist/c/c-DVXLCNRC.js";import"dist/c/c-SPO4YIJK.js";import"dist/c/c-IKQSP3I5.js";import"dist/c/c-IOID33GM.js";import"dist/c/c-YDQL54SX.js";import{a as y}from"dist/c/c-4MHJC562.js";import{b as u}from"dist/c/c-O6VQZMRI.js";import"dist/c/c-43Y5K2SV.js";import"dist/c/c-Q5O4ZW2A.js";import{d as m}from"dist/c/c-FP2E5KKM.js";var r=m(y()),a=m(u());_();var w=o.extend({MIN_TOP_SCROLL_SPACE:5,TIME_OF_STOPPED_SCROLL:55,render:function(){return this.makeBox("widget-slideshow"),this.pictures=a.default.filter(this.pictures,function(t){return!t.error}),this.player=new g({params:this,$container:this.$el,environment:"viewer",block:null,mag:this.page&&this.page.mag,page:this.page,viewport:this.page.pageViewport}),this.play_method!==void 0&&this.play_method==="scroll"&&((0,r.default)(window).on("scroll",this.onScrollTransition),this.innerContentTop=this.page.contentPosition.top/this.page.scale,this.innerContainerHeight=this.page.mag.getContainerSizeCached().height/this.page.scale,this.isScrolling=!1,this.$image=this.$el.find(".image"),this.lastScrollTop=0,this.isCrossfade=this.transition_type==="crossfade",this.delay=(this.theme_data.scroll_delay>0?this.theme_data.scroll_delay:1)+(this.isCrossfade?this.theme_data.crossfade:0),this.picsID=[],this.player.$images_wrapper.children(".image").each((e,i)=>{this.picsID.push((0,r.default)(i).attr("data-id"))})),this.player.on("ready",a.default.bind(function(){setTimeout(this.widgetIsLoaded,100)},this)),this.theme_data.arrows&&(this.theme_data.arrows_type==="library"||this.theme_data.arrows_type==="noun")&&this.renderNounIcons(),this.rendered=!0,this},onScrollTransition:function(){let t=window.pageYOffset||document.documentElement.scrollTop,e=this.y+this.innerContentTop,i=e-this.innerContainerHeight,s=0,n=s*(e-i)+i+this.theme_data.start_offset||0,d=this.isCrossfade?this.theme_data.crossfade*10:this.TIME_OF_STOPPED_SCROLL,l=this.picsID.length,f=n>0?(t-n*this.page.scale)/this.page.scale:t/this.page.scale,c=Math.floor(f/this.delay),h=c+1,p=h>=l?h-Math.floor(h/l)*l:h;this.isScrolling&&(this.setFreezeStyles(t),p>=0&&this.player.currentImageID!==this.picsID[p]&&this.changeImage(t,c,this.picsID[p])),n<=0&&t<this.MIN_TOP_SCROLL_SPACE?setTimeout(()=>{this.changeImage(t,c,this.picsID[0]),this.isScrolling=!1},d):(clearTimeout(this.isScrolling),this.isScrolling=setTimeout(()=>{this.setFreezeStyles(t)},d))},changeImage:function(t,e,i){(t>this.lastScrollTop&&t>=e*this.delay||t<this.lastScrollTop&&t>=(e-1)*this.delay)&&this.player.moveToImage(i,!0,"switch-to-image-scroll"),this.lastScrollTop=t<=0?0:t},setFreezeStyles:function(){let t=this.$el.find(".center-image"),e=this.$el.find(".prev-image"),i=this.getRealOpacity(t.css("opacity")),s=this.getRealOpacity(e.css("opacity"));this.isCrossfade&&(t.css({opacity:i>s?i:1-s}),e.css({opacity:s>i?s:1-i}),!t.hasClass("changed-opacity")&&!e.hasClass("changed-opacity")&&e.addClass("changed-opacity"))},getRealOpacity:function(t){return t<.1?t*10:t},renderNounIcons:function(){let t=this.theme_data.arrows_position,e=this.left_arrow_noun&&this.left_arrow_noun.rasterUrl?this.left_arrow_noun:this.theme_data.left_icon_noun,i=this.right_arrow_noun&&this.right_arrow_noun.rasterUrl?this.right_arrow_noun:this.theme_data.right_icon_noun;if(e&&(e.rasterUrl||e.b64url)){let s=(0,r.default)("<img>");s.on("load",a.default.bind(function(){t==="bottom"?this.$el.find(".prev-picture-arrow-bottom").empty().html(s.clone()):this.$el.find(".prev-picture-arrow-middle").empty().html(s.clone())},this)).on("error",this.widgetIsLoaded),s.attr("src",e.raster3xUrl||e.raster2xUrl||e.rasterUrl||e.b64url||"")}if(i&&(i.rasterUrl||i.b64url)){let s=(0,r.default)("<img>");s.on("load",a.default.bind(function(){t==="bottom"?this.$el.find(".next-picture-arrow-bottom").empty().html(s.clone()):this.$el.find(".next-picture-arrow-middle").empty().html(s.clone())},this)).on("error",this.widgetIsLoaded),s.attr("src",i.raster3xUrl||i.raster2xUrl||i.rasterUrl||i.b64url||"")}},isValid:function(){return this.pictures&&this.pictures.length},start:function(){return o.prototype.start.call(this),!RM.screenshot&&!this.destroyed&&this.player&&(this.theme_data.autoplay&&this.play_method===void 0||this.play_method==="autoplay")&&this.rendered&&this.loaded&&this.player.startAutoplay(),this},stop:function(){return o.prototype.stop.call(this),!RM.screenshot&&!this.destroyed&&this.player&&this.rendered&&this.loaded&&this.player.stopAutoplay(),this},destroy:function(){return this.player&&this.player.off(),this.player&&this.player.destroy(),this.player=null,this.play_method==="scroll"&&(0,r.default)(window).off("scroll",this.onScrollTransition),o.prototype.destroy.apply(this,arguments)}}),T=w;export{T as default};
